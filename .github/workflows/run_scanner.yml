name: Daily Stock Scan

on:
  schedule:
    # This tells the robot to run every hour at the '0' minute (e.g., 1:00, 2:00)
    # 1-5 means Monday through Friday.
    - cron: '0 * * * 1-5'
  workflow_dispatch:
    # This adds a "Run" button so you can test it manually anytime.

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Scanner
      env:
        # This tells the robot to use your hidden secrets for safety
        TRADING_EMAIL: ${{ secrets.TRADING_EMAIL }}
        TRADING_PASSWORD: ${{ secrets.TRADING_PASSWORD }}
      run: python scanner_v4_web_ready.py

    - name: Commit and Push changes
      run: |
        git config --global user.name "Scanner Robot"
        git config --global user.email "bot@github.com"
        # Ensure the public folder exists so we don't get errors
        mkdir -p public
        # This takes the new 'signals.json' file and saves it back to your repo
        git add public/signals.json
        git commit -m "Automated Market Update [skip ci]" || echo "No changes to commit"
        git push
